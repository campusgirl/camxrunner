RELEASE NOTES for CAMx v4.42, 06/03/07

The Comprehensive Air Quality Model with extensions (CAMx) is
available at http://www.camx.com.  

Join the CAMx User's Group by sending an e-mail message to
Majordomo@environ.org with the words "subscribe CAMxusers" 
in the body of the message. When you subscribe, Majordomo 
will send you a reply that provides details on how to use 
this list server.

The "camxusers" group is meant for broadcasting useful
information about CAMx and its pre- and post-processors to
all users that subscribe to this group, or to ask about
available datasets or issues that other users may have come
across.  It is not meant for asking how to run CAMx or how
to prepare inputs.   

Please direct specific comments or questions about problems
or bugs with CAMx or its support software to camx@environ.org,
which comes directly to the developers.


Overview of Version 4.42
------------------------

V4.42 is an extension from the previous release (v4.40).
Version 4.42 provides several important bug fixes mostly to
the PSAT Probing Tool that have been identified since the
release of v4.40 in October 2006.

There are no major changes to the core model from v4.40, so if
you are not using PSAT, there is no need to upgrade to v4.42.
Minor changes to the core model chemistry result in 0.001-0.01
ppb ozone differences and ~0.01 ug/m3 PSO4 and PNO3 changes.

There are no changes from version 4.40 to input file formats
or the control file (CAMx.in) format.  The CAMx version 4.40
User's Guide should be used with version 4.42.

The CAMx test case has not changed.


v4.42 Bug Fixes
---------------

1. Fixed bug that caused output average files in UAM Fortran
   binary format to have double headers when running Source
   Apportionment probing tools.

   Implications: The output average files are now readable when
                 using OSAT or PSAT.

   Affected routines: CLCIWT.F, CNCPREP.F

2. Fixed bug in using point source override for PiG sources.

   Implications: Point source region override was made more
                 robust to work with all possible combinations
                 of Plume-in-Grid submodel and OSAT/PSAT.

   Affected routines: SUM1PNT.F

3. Fixed bug in calculating emissions table for tracers.

   Affected routines: SUM1PNT.F

4. Fixed bug in calculating concentration changes for Probing Tools
   when not performing a PM chemstry step.

   Affected routines: CHEMDRIV.F

5. Added plume rise override to PiG

   Implications: Plume rise is defined in the point source input
                 file when derived from a CMAQ input file; a
                 plume rise override flag is set in the emissions
                 file to tell CAMx to ignore the plume rise
                 calculation.  PiG now recognizes the plume rise
                 override flag to be consistent with non-PiG
                 point sources.

   Affected routines: PIGINIT.F

6. Changed aqueous chemistry to improve stability under
   exceptionally high sulfate or nitrate conditions that could
   only occur near an emissions source with high primary
   emsisions of sulfate or nitrate.

   Implications: Aqueous chemistry gets very stiff under high
                 acid conditions.  This change will account for
                 the shutdown of aqueous chemical pathways under
                 such conditions. This should not have any
                 impact for the vast majority of CAMx users.

   Affected routines: CHEMDRIV.F

7. Added update of Probing Tool boundary conditions after met
   is updated

   Affected routines: EMISTRNS.F

8. Fixed bug that caused top boundary conditions for PSAT PM
   species to be converted to umol/m3.

   Affected routines: ZADVEC.F

9. Several minor bug fixes to improve handling of PSAT tracers
   at small concentrations (near lower bounds).

   Affected routines: CYCTPNSA.F, PSATSA.F, RECALIB.F, REPARTSA.F


Overview of Version 4.40
------------------------

V4.40 is an extension from the previous release (v4.31).
Version 4.40 introduces several modifications to incorporate
PM into the PiG sub-model (including PSAT), improve speed
performance, improve concentration output file flexibility,
enhance the SAPRC chemical mechanism, and include PM into the
IPR component of Process Analysis.  This version also provides
several bug fixes.

*** The conventions for CAMx output average, deposition, restart,
    and Probing Tool files have changed -- please see the README
    file located in the source code directory.  This impacts
    the names of restart files in the CAMx control file.

*** The operation of the Makefile has changed -- please read
    the README file located in the source code directory.

*** The SAPRC99 and CB-IV chemistry parameters files for v4.40
    have been updated.  You must use files chemparam files
    specifically labelled "VERSION4.4"

There are no changes to other input file formats from version
4.31.


v4.40 Modifications
-------------------

1. PM chemistry and Particle Source Apportioment Technology
   (PSAT) have been added to the PiG sub-model.  As part of
   this change, PiG now includes dry and wet deposition.
   Also, the GREASD PiG algorithms have been fully unified
   with IRON PiG; the only difference with GREASD PiG is the
   point at which puff mass is transferred to the grid.

   Implications: Users may now run PiG with PM chemistry
                 (RADM-AQ, ISOROPIA, SOAP) and PSAT.  To 
                 facilitate PSAT, PM can only be run with
                 the GREASD option.  GREASD PiG now uses the
                 same incremental chemistry as IRON PiG, but
                 it remains focused on treating large NOx
                 point sources.  The only difference with
                 GREASD is that puff mass is passed to the
                 grid at the point when oxidant production
                 (organic chemistry) becomes important.

   Affected routines: Most subroutines in the PiG sub-directory;
                      CHEMDRIV.F, new routine AEROCHEM_AQ.F

2. To increase model speed, the calculation of the driving
   time step on each grid was revised to maximize time step
   size for the given grid resolution and wind speed.
   Additionally, the maximum allowable time step was increased
   for the Bott advection algorithm because it has demonstrated
   numerical stability for CFL numbers near 1.

   Implications: The model will run faster, but the speed-up
                 will depend upon the conditions in a given
                 application.  The choice of using Bott will
                 lead to a further increase in model speed.
                 Testing of both Bott and PPM advection options
                 is recommended.

   Affected routines: GETDELT.F

3. Implemented HDF5 output file option, removed VFM place-holder.

   Implications: CAMx optionally writes concentration fields to
                 HDF5 files following the conventions of the 
                 Regional Atmospheric Modeling System (RAMS).
                 Both core model and probing tool fields can be
                 written, for both computational and PiG sampling
                 grids.  Individual HDF5 files are written for
                 each grid, and for each output time.

                 The makefile has changed to include the "HDF"
                 variable.  The command-line argument "HDF=true"
                 will compile CAMx to include HDF5 I/O libraries.
                 This requires that HDF5 libraries have been
                 installed and built on the machine that is
                 running this Makefile.  You should check that
                 the variables HDF_LIB and HDF_INC in the Makefile
                 are set correctly.  If HDF is not set on the
                 command line, CAMx will not be able to write
                 HDF5 files.  See the README and Makefile for
                 more details.

   Affected routines: CAMx.F, a new IO_hdf sub-directory holds
                      all HDF-related routines.  The IO_vfm sub-
                      directory has been removed.

4. The output average, deposition, and surface Probing Tool
   fields for each grid (computational and PiG sampling) are
   now separately output to individual files in the standard
   UAM format, which is consistent with the formats of the
   CAMx input emissions, input initial conditions, and master
   grid output format.

   Implications:  Each file is individually labeled by grid
                  number, alleviating the need to extract
                  specific nested grid fields from the original
                  single nested grid output file.  This format
                  change does not impact instantaneous restart
                  file formats; however, single master and
                  nested grid restart files are now only output
                  at the end of the specified simulation period.
                  The odd/even hour restart output file
                  constructs have been eliminated.  See the
                  README file for more information.

   Affected routines: CAMx.F, READNML.F, STARTUP.F, RDOPTDDM.F,
                      STARTDDM.F, FILUNIT.COM, TRACER.COM,
                      CNCPREP.F, DEPPREP.F, OPENFILS.F, HDRWSA.F,
                      RDOPTSA.F, STARTSA.F, WSFCSA.F, WRTIRR.F,
                      STARTRT.F;
                      removed WRFGAVG.F, WRFGDEP.F, INSTSA.F,
                      WRFGSA.F, WRTCGPA.F, WRTFGPA.F;
                      new WCONSA.F, WFCONSA.F, WSFCSA.F, WRTCPA.F

5. Enhanced SAPRC to include three additional optional species:
   Ethanol (ETOH), Methyl Tertiary Butyl Ether (MTBE), and
   Methylbutenol (MBUT), and gas-phase reactions involving
   these species.  The SAPRC99 (Mechanism 5) chemstry parameters
   file now uses molecular units for reaction rate parameters.

   Implications: The VERSION4.4 Mechanism 5 chemistry parameters
                 file must be used with CAMx v4.40.  However,
                 the three additional species are optional, and
                 can be removed from the species list -- 
                 Mechanism 5 will continue to operate without
                 them.

   Affected routines: STABSA.F, SPCSPRCSA.F,
                      Mechanism 5 solver routines in CMC
                      directory

6. The Integrated Processes Rate (IPR) component of PA has
   been updated to include aerosol chemistry and PM species.

   Implications: The aerosol chemistry is split into inorganic,
                 organic, and aqueous-phase portions.  The IPR
                 post-processing utility has been updated to
                 handle this change.

   Affected routines: PROCAN.COM, CHEMDRIV.F, AEROCHEM_AQ.F,
                      AEROCHEM_CF.F, WRTIPRHDR.F

7. The "metastable" option was removed in ISORROPIA.

   Implications: Liquid-only aerosol is no longer forced by
                 presence of cloud water.  This makes the results
                 from ISORROPIA more consistent with ambient
                 relative humidity.

   Affected routines: AEROCHEM_AQ.F, AEROCHEM_CF.F

8. Optional 2-D topographic elevation field is now read from
   the landuse file.

   Implications: Transparent to the user, topography is simply
                 passed from RAMS through CAMx (via the
                 RAMSCAMx interface utility), and written to
                 HDF5 output files.  CAMx will continue to
                 properly read older landuse files that do not
                 include topography.

   Affected routines: METINIT.F, CAMxFLD.COM, STARTUP.F

9. Updated reaction rate parameters in CB-IV chemistry mechanism
   for ISOP, MEOH, and ETOH.

   Implications: The VERSION4.4 Mechanism 1-4 chemistry
                 parameters files must be used with CAMx
                 v4.40.

   Affected routines: STABSA.F


v4.40 Bug Fixes
---------------

1. Fixed bug in caclulating the WALL OF CELLS receptor average
   concentration for Probing tools. The timing weight used for the
   running average was in hours instead of minutes.

   Implications: The concetrations in probing tools receptor file
                 for any WALL OF CELLS receptor was overestimated
                 by a factor of 60.

   Affected routines: AVGWAL.F

2. Fixed bug in implementing the point source override for Probing 
   Tools.  

   Implications: If the Plume-in-Grid submodel was active and a 
                 source was flagged as a PiG source the point 
                 source override was ignored.  This means that 
                 all PiG'ed sources were placed in the source 
                 region indicated by the cell containing the 
                 source, regardless of point source override flag.

   Affected routines: SUMGRPS.F, SUM1PNT.F

3. Fixed MIR values and molecular weights for SAPRC99 VOC
   species.

   Implications: MIR values are corrected to molar ratios and 
                 molecular weights for SAPRC99 VOC species are
                 updated. This may have an impact on OSAT
                 results with SAPRC99 chemistry mechanism.

   Affected routines: STABSA.F, SPCSPRCSA.F

4. Fixed unit conversion formula for reaction type 7.

   Implications: This bug only affects the cases where the rate
                 parameters for type 7 reactions are given in
                 molecular units.

   Affected routines: EXPTBL.F

5. Fixed a minor parent grid indexing bug for determining nested
   grid boundary conditions.

   Implications: A small difference in nested grid boundary
                 conditions will result, especially in areas of
                 large concentration gradients.  This may have
                 an impact on nested grid concentrations.

   Affected routines: BC1GRD.F

6. Added map scale factors to several mass budget accounting
   components.

   Implications: Corrects a minor omission in certain mass
                 counters that led to imprecision in the mass
                 budget summaries (i.e., the output mass budget
                 file).  The change is transparent to users,
                 and only affects some mass components in the
                 diagnostic mass summary file.

   Affected routines: WETDEPRT.F, EMISTRNS.F, WETDEP.F,
                      DIFFUS.F, VIRTDUMP.F, PIGDRIVE.F,
                      IRONWET.F, IRONDRY.F, PIGEVOL.F,
                      CHEMRXN.F, AGGR00.F, MASSUM.F
